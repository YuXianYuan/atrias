/**
  * @file ASC_SLIP_MODEL.cpp
  * @author Mikhail Jones
  * @brief This implements a numerical integrator to solve the SLIP dynamics.
  */

// To use do something like this.
// // Define slipState struct
// slipState.r = 0.85;
// slipState.dr = -sqrt(2.0*9.81*0.05);
// slipState.q = PI/2.0;
// slipState.dq = 0.0;
//
// // Compute and set legForce
// ASCSlipModel.k = ASCCommonToolkit.legStiffness(r, r0);
// slipState = ASCSlipModel.advance(slipState);
// legForce = ASCSlipModel.force(slipState);

#include "asc_slip_model/ASCSlipModel.hpp"

// Again, we need to put our code inside the appropriate namespaces.
namespace atrias {
namespace controller {

/* Breakdown of the next few lines:
 * We need to call our parent class's constructor,
 * then we can call the LogPort's constructor. The second parameter
 * is the name for this log port, which controls how it appears in the
 * bagfiles.
 */
ASCSlipModel::ASCSlipModel(AtriasController *parent, string name) :
        AtriasController(parent, name),
        log_out(this, "log")
{
	// Initialize
	k = 28000.0;
	r0 = 0.85;
	m = M;
}

// advance
SlipState ASCSlipModel::advance(SlipState slipState) {

	// Unpack parameters
	r = slipState.r;
	dr = slipState.dr;
	q = slipState.q;
	dq = slipState.dq;

	// Check phase
	if (r > r0) {
		// Do nothing because we are not in stance
		slipState.isFlight = true;
		slipState.isStance = false;
		
	} else {
		// Advance to next timestep because we are in stance
		slipState.isFlight = false;
		slipState.isStance = true;
		
		// Runges's 5th order Runge-Kutta numerical method
		rNew = r + dr*H*(2.3E1/1.92E2) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.25E2/1.92E2) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) + (r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r, 2) - (k*(r - r0 + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))/m)*(8.0/7.5E1) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(2.0/1.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(1.25E2/1.92E2) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/2.7E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) + (r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r, 2) - (k*(r - r0 + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))/m)*(8.0/8.1E1) - H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(5.0E1/8.1E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.0E1/9.0))*(2.7E1/6.4E1);
		
        drNew = dr + H*((-1.0*G)*sin(q + dq*H*(2.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(1.2E1/2.5E1) + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(2.0/1.5E1) + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r)*(8.0/7.5E1)) + (r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*3.0)*(8.0/7.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(2.0/1.5E1) + dr*H*(2.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.2E1/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(2.0/1.5E1))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.2E1/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(2.0/2.5E1))/r + (H*((-1.0*G)*cos(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*6.0)*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r))*(8.0/7.5E1))/(r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0), 2) - (k*(r - r0 + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*3.0)*(8.0/7.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(2.0/1.5E1) + dr*H*(2.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.2E1/2.5E1)))/m)*(1.25E2/1.92E2) - H*((-1.0*G)*sin(q + dq*H*(2.0/2.7E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(1.0E1/9.0) - H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(5.0E1/8.1E1) + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r)*(8.0/8.1E1)) + (r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*3.0)*(8.0/8.1E1) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(5.0E1/8.1E1) + dr*H*(2.0/2.7E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.0E1/9.0))*pow(dq - (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(5.0E1/8.1E1))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.0E1/9.0))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(2.0/2.7E1))/r + (H*((-1.0*G)*cos(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*6.0)*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r))*(8.0/8.1E1))/(r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0), 2) - (k*(r - r0 + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*3.0)*(8.0/8.1E1) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(5.0E1/8.1E1) + dr*H*(2.0/2.7E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.0E1/9.0)))/m)*(2.7E1/6.4E1) + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.3E1/1.92E2) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.25E2/1.92E2);
        
        qNew = q + dq*H*(2.3E1/1.92E2) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(1.25E2/1.92E2) + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(2.0/1.5E1))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.2E1/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(2.0/2.5E1))/r + (H*((-1.0*G)*cos(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*6.0)*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r))*(8.0/7.5E1))/(r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))*(1.25E2/1.92E2) - H*(dq - (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(5.0E1/8.1E1))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.0E1/9.0))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(2.0/2.7E1))/r + (H*((-1.0*G)*cos(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*6.0)*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r))*(8.0/8.1E1))/(r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))*(2.7E1/6.4E1);
        
        dqNew = dq - (H*((dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) + (r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r, 2) - (k*(r - r0 + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))/m)*(1.6E1/7.5E1) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(4.0/1.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(2.4E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(2.0/1.5E1))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.2E1/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(2.0/2.5E1))/r + (H*((-1.0*G)*cos(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*6.0)*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r))*(8.0/7.5E1))/(r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)) - (-1.0*G)*cos(q + dq*H*(2.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(1.2E1/2.5E1) + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(2.0/1.5E1) + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r)*(8.0/7.5E1)))*(1.25E2/1.92E2))/(r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*3.0)*(8.0/7.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(2.0/1.5E1) + dr*H*(2.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.2E1/2.5E1)) + (H*((dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.7E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) + (r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r, 2) - (k*(r - r0 + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))/m)*(1.6E1/8.1E1) - H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.0E2/8.1E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(2.0E1/9.0))*(dq - (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(5.0E1/8.1E1))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.0E1/9.0))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(2.0/2.7E1))/r + (H*((-1.0*G)*cos(q + dq*H*(1.0/4.0) - H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*3.0 + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*6.0)*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r))*(8.0/8.1E1))/(r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*H*(1.0/4.0) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)) - (-1.0*G)*cos(q + dq*H*(2.0/2.7E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(1.0E1/9.0) - H*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r)*(5.0E1/8.1E1) + H*(dq + (H*((-1.0*G)*cos(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/4.0))/r)*(8.0/8.1E1)))*(2.7E1/6.4E1))/(r + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + H*((-1.0*G)*sin(q + dq*H*(4.0/2.5E1) + H*(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*H*(4.0/2.5E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*3.0)*(8.0/8.1E1) - H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + H*((-1.0*G)*sin(q + dq*H*(1.0/3.0)) + pow(dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r, 2)*(r + dr*H*(1.0/3.0)) - (k*(r - r0 + dr*H*(1.0/3.0)))/m)*(6.0/2.5E1))*(5.0E1/8.1E1) + dr*H*(2.0/2.7E1) + H*(dr + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.0E1/9.0)) + (H*((-1.0*G)*cos(q + dq*H*(1.0/3.0)) - (dq - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(1.0/3.0))/r)*(dr*2.0 + H*((dq*dq)*r + (-1.0*G)*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.25E2/1.92E2))/(r + dr*H*(1.0/3.0)) - (H*(dq*dr*2.0 - (-1.0*G)*cos(q))*(2.3E1/1.92E2))/r;
		
		// Advance time step, replace old with new
        slipState.r = rNew;
        slipState.dr = drNew;
        slipState.q = qNew;
        slipState.dq = dqNew;

	}

    // Set the log data
    log_out.data.r = slipState.r;
    log_out.data.dr = slipState.dr;
    log_out.data.q = slipState.q;
    log_out.data.dq = slipState.dq;

    // Transmit the log data
    log_out.send();

	// Return new SLIP state
    return slipState;

} // advance


// force
LegForce ASCSlipModel::force(SlipState slipState) {

    // Unpack parameters
    r = slipState.r;
    dr = slipState.dr;
    q = slipState.q;
    dq = slipState.dq;

	// If virtual SLIP model is in flight
	if (slipState.isFlight) {
		// Define component force.
		legForce.fx = 0.0;
		legForce.fz = 0.0;
		legForce.dfx = 0.0;
		legForce.dfz = 0.0;

	// If virtual SLIP model is in NOT in flight (is in stance)
	} else {
		// Define component forces.
		legForce.fx = k*(r - r0)*cos(q);
		legForce.fz = k*(r - r0)*sin(q);
		legForce.dfx = dr*k*cos(q) - dq*k*sin(q)*(r - r0);
		legForce.dfz = dr*k*sin(q) + dq*k*cos(q)*(r - r0);
	}

    // Set the log data
    log_out.data.fx = legForce.fx;
    log_out.data.fz = legForce.fz;
    log_out.data.dfx = legForce.dfx;
    log_out.data.dfz = legForce.dfz;

    // Transmit the log data
    log_out.send();
    
    // Return the leg force
	return legForce;

} // force

}
}

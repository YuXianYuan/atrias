/**
  * @file ASC_SLIP_MODEL.cpp
  * @author Mikhail Jones
  * @brief This implements a numerical integrator to solve the SLIP dynamics.
  */

// To use do something like this.
// // Define slipModel struct
// slipModel.g = -9.81;
// slipModel.k = 4118.0; // This is not the virtual leg spring but the actual rotational spring
// slipModel.m = 607.5/9.81;
// slipModel.r0 = 0.85;
//
// // Define slipState struct
// slipState.r = 0.85;
// slipState.dr = -sqrt(2.0*9.81*0.05);
// slipState.q = M_PI/2.0;
// slipState.dq = 0.0;
//
// // Compute and set legForce
// slipState = slipAdvance0(slipModel, slipState);
// legForce = slipForce0(slipModel, slipState);

// TODO - Use ASCCommonToolkit::legStiffness
// TODO - Add error catch incase structs are empty.
// TODO - Add backup RK4 approximation

#include "asc_slip_model/ASCSlipModel.hpp"

// Again, we need to put our code inside the appropriate namespaces.
namespace atrias {
namespace controller {

/* Breakdown of the next few lines:
 * We need to call our parent class's constructor,
 * then we can call the LogPort's constructor. The second parameter
 * is the name for this log port, which controls how it appears in the
 * bagfiles.
 */
ASCSlipModel::ASCSlipModel(AtriasController *parent, string name) :
        AtriasController(parent, name),
        log_out(this, "log")
{
	// No init required for this controller
}

// slipAdvance
SlipState ASCSlipModel::slipAdvance(SlipModel slipModel, SlipState slipState) {

	// Unpack parameters
	r = slipState.r;
	dr = slipState.dr;
	q = slipState.q;
	dq = slipState.dq;
	k = slipModel.k;
	r0 = slipModel.r0;
	m = slipModel.m;
	g = -g; // TODO - flip sign in RK5 equations

	// Check phase
	if (r > r0) {
		// Do nothing because we are not in stance
		slipState.isFlight = true;
		slipState.isStance = false;
		
	} else {
		// Advance to next timestep because we are in stance
		slipState.isFlight = false;
		slipState.isStance = true;
		
		// Compute non-linear ATRIAS leg length stiffness
		k = ks*(sin(acos(r)) - (acos(r) - acos(r0))*cos(acos(r)))/(2.0*l1*l2*pow(sin(acos(r)), 3));
		
		// Runges's 5th order Runge-Kutta numerical method
		slipState.r = r + dr*h*(2.3E1/1.92E2) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.25E2/1.92E2) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) + (r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)*pow(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r, 2) - (k*(r - r0 + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))/m)*(8.0/7.5E1) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(2.0/1.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(1.25E2/1.92E2) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/2.7E1) + h*(g*sin(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) + (r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)*pow(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r, 2) - (k*(r - r0 + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))/m)*(8.0/8.1E1) - h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(5.0E1/8.1E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.0E1/9.0))*(2.7E1/6.4E1);
		
        slipState.dr = dr + h*(g*sin(q + dq*h*(2.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(1.2E1/2.5E1) + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(2.0/1.5E1) + h*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r)*(8.0/7.5E1)) + (r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*3.0)*(8.0/7.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(2.0/1.5E1) + dr*h*(2.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.2E1/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(2.0/1.5E1))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.2E1/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(2.0/2.5E1))/r + (h*(g*cos(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*6.0)*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r))*(8.0/7.5E1))/(r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0), 2) - (k*(r - r0 + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*3.0)*(8.0/7.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(2.0/1.5E1) + dr*h*(2.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.2E1/2.5E1)))/m)*(1.25E2/1.92E2) - h*(g*sin(q + dq*h*(2.0/2.7E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(1.0E1/9.0) - h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(5.0E1/8.1E1) + h*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r)*(8.0/8.1E1)) + (r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*3.0)*(8.0/8.1E1) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(5.0E1/8.1E1) + dr*h*(2.0/2.7E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.0E1/9.0))*pow(dq - (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(5.0E1/8.1E1))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.0E1/9.0))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(2.0/2.7E1))/r + (h*(g*cos(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*6.0)*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r))*(8.0/8.1E1))/(r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0), 2) - (k*(r - r0 + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*3.0)*(8.0/8.1E1) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(5.0E1/8.1E1) + dr*h*(2.0/2.7E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.0E1/9.0)))/m)*(2.7E1/6.4E1) + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.3E1/1.92E2) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.25E2/1.92E2);
        
        slipState.q = q + dq*h*(2.3E1/1.92E2) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(1.25E2/1.92E2) + h*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(2.0/1.5E1))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.2E1/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(2.0/2.5E1))/r + (h*(g*cos(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*6.0)*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r))*(8.0/7.5E1))/(r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))*(1.25E2/1.92E2) - h*(dq - (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(5.0E1/8.1E1))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.0E1/9.0))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(2.0/2.7E1))/r + (h*(g*cos(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*6.0)*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r))*(8.0/8.1E1))/(r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))*(2.7E1/6.4E1);
        
        slipState.dq = dq - (h*((dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) + (r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)*pow(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r, 2) - (k*(r - r0 + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))/m)*(1.6E1/7.5E1) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(4.0/1.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(2.4E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(2.0/1.5E1))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.2E1/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(2.0/2.5E1))/r + (h*(g*cos(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*6.0)*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r))*(8.0/7.5E1))/(r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)) - g*cos(q + dq*h*(2.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(1.2E1/2.5E1) + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(2.0/1.5E1) + h*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r)*(8.0/7.5E1)))*(1.25E2/1.92E2))/(r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*3.0)*(8.0/7.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(2.0/1.5E1) + dr*h*(2.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.2E1/2.5E1)) + (h*((dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.7E1) + h*(g*sin(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) + (r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)*pow(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r, 2) - (k*(r - r0 + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0))/m)*(1.6E1/8.1E1) - h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.0E2/8.1E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(2.0E1/9.0))*(dq - (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(5.0E1/8.1E1))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.0E1/9.0))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(2.0/2.7E1))/r + (h*(g*cos(q + dq*h*(1.0/4.0) - h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*3.0 + h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(1.5E1/4.0)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/2.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/2.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*6.0)*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r))*(8.0/8.1E1))/(r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(1.5E1/4.0) + dr*h*(1.0/4.0) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*3.0)) - g*cos(q + dq*h*(2.0/2.7E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(1.0E1/9.0) - h*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r)*(5.0E1/8.1E1) + h*(dq + (h*(g*cos(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) - (dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(8.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(1.2E1/2.5E1))*(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r))*(1.5E1/4.0))/(r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)) - (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*3.0)/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(1.0/4.0))/r)*(8.0/8.1E1)))*(2.7E1/6.4E1))/(r + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/4.0) + h*(g*sin(q + dq*h*(4.0/2.5E1) + h*(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(6.0/2.5E1)) + (r + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1))*pow(dq + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(6.0/2.5E1))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(4.0/2.5E1))/r, 2) - (k*(r - r0 + dr*h*(4.0/2.5E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(6.0/2.5E1)))/m)*(1.5E1/4.0) - h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*3.0)*(8.0/8.1E1) - h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(4.0/2.5E1) + h*(g*sin(q + dq*h*(1.0/3.0)) + pow(dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r, 2)*(r + dr*h*(1.0/3.0)) - (k*(r - r0 + dr*h*(1.0/3.0)))/m)*(6.0/2.5E1))*(5.0E1/8.1E1) + dr*h*(2.0/2.7E1) + h*(dr + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(1.0/3.0))*(1.0E1/9.0)) + (h*(g*cos(q + dq*h*(1.0/3.0)) - (dq - (h*(dq*dr*2.0 - g*cos(q))*(1.0/3.0))/r)*(dr*2.0 + h*((dq*dq)*r + g*sin(q) - (k*(r - r0))/m)*(2.0/3.0)))*(1.25E2/1.92E2))/(r + dr*h*(1.0/3.0)) - (h*(dq*dr*2.0 - g*cos(q))*(2.3E1/1.92E2))/r;
		
		// Advance time step, replace old with new
        slipState.rOld = r;
        slipState.drOld = dr;
        slipState.qOld = q;
        slipState.dqOld = dq;

	}

    // Set the log data
    log_out.data.r = r;
    log_out.data.dr = dr;
    log_out.data.q = q;
    log_out.data.dq = dq;

    // Transmit the log data
    log_out.send();

	// Return new SLIP state
    return slipState;

} // slipAdvance


// slipForce
LegForce ASCSlipModel::slipForce(SlipModel slipModel, SlipState slipState) {

    // Unpack parameters
    r = slipState.r;
    dr = slipState.dr;
    q = slipState.q;
    k = slipModel.k;
    r0 = slipModel.r0;

	// If virtual SLIP model is in flight
	if (slipState.isFlight) {
		// Define component force.
		legForce.fx = 0.0;
		legForce.fz = 0.0;
		legForce.dfx = 0.0;
		legForce.dfz = 0.0;

	// If virtual SLIP model is in NOT in flight (is in stance)
	} else {	
		
		// Compute non-linear ATRIAS leg length stiffness 
		k = ks*(sin(acos(r)) - (acos(r) - acos(r0))*cos(acos(r)))/(2.0*l1*l2*pow(sin(acos(r)), 3));

		// Define component forces.
		legForce.fx = k*(r - r0)*cos(q);
		legForce.fz = k*(r - r0)*sin(q);
		legForce.dfx = k*(dr - 0.0)*cos(q);
		legForce.dfz = k*(dr - 0.0)*sin(q);
	}

    // Set the log data
    log_out.data.fx = legForce.fx;
    log_out.data.fz = legForce.fz;
    log_out.data.dfx = legForce.dfx;
    log_out.data.dfz = legForce.dfz;

    // Transmit the log data
    log_out.send();
    
    // Return the leg force
	return legForce;

} // slipForce

}
}
